# Docker Compose for OnlyPerf Monorepo
# Usage:
#   1. Copy .env.example to .env at monorepo root
#   2. Copy apps/*/env.example to apps/*/.env.local for build secrets
#   3. Run: docker-compose build && docker-compose up -d

services:
  onlyperf:
    build:
      context: .
      dockerfile: apps/onlyperf/Dockerfile
      secrets:
        - env_onlyperf
      args:
        # Public vars (baked into client bundle at build time)
        NEXT_PUBLIC_STORE_DOMAIN: ${NEXT_PUBLIC_STORE_DOMAIN}
        NEXT_PUBLIC_SITE_URL: ${NEXT_PUBLIC_SITE_URL:-https://onlyperf.com}
    ports:
      - "3000:3000"
    env_file:
      - apps/onlyperf/.env
    environment:
      NODE_ENV: production
    restart: unless-stopped

  warehouse:
    build:
      context: .
      dockerfile: apps/warehouse-management/Dockerfile
      secrets:
        - env_warehouse
      args:
        # Public vars (baked into client bundle at build time)
        NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL:-https://warehouse.onlyperf.com}
        NEXT_PUBLIC_BASE_URL: ${NEXT_PUBLIC_BASE_URL:-https://onlyperf.com}
        NEXT_PUBLIC_SHOPIFY_ENABLED: ${NEXT_PUBLIC_SHOPIFY_ENABLED:-false}
    ports:
      - "3001:3001"
    env_file:
      - apps/warehouse-management/.env
    environment:
      NODE_ENV: production
    restart: unless-stopped

secrets:
  env_onlyperf:
    file: apps/onlyperf/.env
  env_warehouse:
    file: apps/warehouse-management/.env
